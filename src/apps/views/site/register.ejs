<%- include("layouts/head.ejs", {title: "Đăng ký"})%> 
<%- include("layouts/header.ejs")%> 
<%- include("layouts/menu.ejs")%>
<%- include("layouts/slider.ejs")%> 

<!-- Body -->
    <div class="container">
        <div class="row justify-content-center mt-5">
            <div class="col-lg-6 col-md-8 col-sm-12">
                <div class="card">
                    <div class="card-header">Đăng ký</div>
                    <div class="card-body">
                        <!-- Form đăng ký -->
                        <form action="/register" method="POST">
                            <%if(data && data.error){%>
                                <div class="alert alert-danger">
                                    <%=data.error%>
                                </div>
                                <%}%>
                            <div class="form-group">
                                <label>Họ và tên</label>
                                <input type="name" class="form-control"  name="full_name" aria-describedby="emailHelp" placeholder="Nhập họ và tên">
                            </div>
                            <div class="form-group">
                                <label>Địa chỉ email</label>
                                <input type="email" class="form-control" name="email" aria-describedby="emailHelp" placeholder="Nhập email">

                            </div>
                            <div class="form-group">
                                <label>Mật khẩu</label>
                                <input type="password" class="form-control"  name="password" placeholder="Nhập mật khẩu">
                            </div>
                            <div class="form-group">
  <label>Địa chỉ cụ thể</label>
  <input
    type="text"
    class="form-control"
    name="address"
    placeholder="Nhập số nhà, tên đường, v.v."
    required
  />
</div>

                           <div class="form-group">
  <label>Tỉnh/Thành</label>
  <select class="form-control" name="province_id" id="province">
    <option value="">Chọn tỉnh/thành</option>
  </select>
</div>

<div class="form-group">
  <label>Quận/Huyện</label>
  <select class="form-control" name="district_id" id="district">
    <option value="">Chọn quận/huyện</option>
  </select>
</div>

<div class="form-group">
  <label>Phường/Xã</label>
  <select class="form-control" name="ward_code" id="ward">
    <option value="">Chọn phường/xã</option>
  </select>
</div>

                            <div class="form-group">
                                <label for="exampleInputPassword2">Số điện thoại</label>
                                <input type="text" class="form-control" name="phone" placeholder="Nhập số điện thoại">
                            </div>
                            <button type="submit" class="btn btn-primary">Đăng ký</button>
                        </form>
                        <!-- Kết thúc form đăng ký -->
                    </div>
                </div>
                <div class="mt-3">
                    <p>Bạn đã có tài khoản? <a href="/login">Đăng nhập ngay</a></p>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- End Body -->

<%- include("layouts/sidebar.ejs")%>
<%- include("layouts/footer.ejs")%>
<script>
const provinceSelect = document.getElementById("province");
const districtSelect = document.getElementById("district");
const wardSelect = document.getElementById("ward");

fetch("https://dev-online-gateway.ghn.vn/shiip/public-api/master-data/province", {
  method: "GET",
  headers: { "token": "1755fed2-bf9b-11f0-a51e-f64be07fcf0a" }
})
  .then(res => res.json())
  .then(data => {
    data.data.forEach(province => {
      const opt = document.createElement("option");
      opt.value = province.ProvinceID;
      opt.text = province.ProvinceName;
      provinceSelect.add(opt);
    });
  });

provinceSelect.addEventListener("change", () => {
  districtSelect.innerHTML = '<option value="">Chọn quận/huyện</option>';
  wardSelect.innerHTML = '<option value="">Chọn phường/xã</option>';
  const province_id = provinceSelect.value;
  if (!province_id) return;

  fetch("https://dev-online-gateway.ghn.vn/shiip/public-api/master-data/district", {
    method: "POST",
    headers: { "Content-Type": "application/json", "token": "1755fed2-bf9b-11f0-a51e-f64be07fcf0a" },
    body: JSON.stringify({ province_id: Number(province_id) })
  })
    .then(res => res.json())
    .then(data => {
      data.data.forEach(district => {
        const opt = document.createElement("option");
        opt.value = district.DistrictID;
        opt.text = district.DistrictName;
        districtSelect.add(opt);
      });
    });
});

districtSelect.addEventListener("change", () => {
  wardSelect.innerHTML = '<option value="">Chọn phường/xã</option>';
  const district_id = districtSelect.value;
  if (!district_id) return;

  fetch(`https://dev-online-gateway.ghn.vn/shiip/public-api/master-data/ward?district_id=${district_id}`, {
    method: "GET",
    headers: { "token": "1755fed2-bf9b-11f0-a51e-f64be07fcf0a" }
  })
    .then(res => res.json())
    .then(data => {
      data.data.forEach(ward => {
        const opt = document.createElement("option");
        opt.value = ward.WardCode;
        opt.text = ward.WardName;
        wardSelect.add(opt);
      });
    });
});
</script>
